# engine/results_to_html.py
import json, sys, html
IN = "scan_results.json"
OUT = "scan_report.html"

def load(path=IN):
    with open(path,"r") as f:
        return json.load(f)

def host_color(port_count):
    if port_count == 0: return "#c8e6c9"   # green-ish
    if port_count <= 2: return "#fff9c4"   # yellow-ish
    return "#ffcdd2"                       # red-ish

def build_html(results):
    html_parts = [
        "<!doctype html><html><head><meta charset='utf-8'><title>Sentinel Scan Report</title>",
        "<style>body{font-family:Arial; padding:16px;} .host{border-radius:8px;padding:10px;margin:8px 0;} .port{font-family:monospace;}</style>",
        "</head><body>",
        "<h1>Sentinel — Scan Report</h1>",
        "<p>Generated by engine/results_to_html.py</p>",
    ]
    if not results:
        html_parts.append("<p><em>No hosts found.</em></p>")
    for host, services in sorted(results.items()):
        count = len(services)
        color = host_color(count)
        html_parts.append(f"<div class='host' style='background:{color}'>")
        html_parts.append(f"<h3>{host} — {count} open port(s)</h3>")
        if count:
            html_parts.append("<ul>")
            for s in services:
                banner = html.escape(s.get('banner') or '')
                html_parts.append(f"<li class='port'><strong>{s.get('port')}</strong> — {banner}</li>")
            html_parts.append("</ul>")
        html_parts.append("</div>")
    html_parts.append("</body></html>")
    return "\n".join(html_parts)

def main():
    try:
        results = load()
    except FileNotFoundError:
        print("scan_results.json not found; run the scanner first.")
        return
    out = build_html(results)
    with open(OUT,"w") as f:
        f.write(out)
    print(f"Wrote report to {OUT} — open it with your browser (e.g. code {OUT} or xdg-open {OUT})")

if __name__ == "__main__":
    main()
